(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[105],{105:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>f});var s=t(43),r=t(213),n=t(475),l=t(466),o=t(843),i=t(446),c=t.n(i),d=t(579);const u=e=>{let{handleSubmit:a}=e;const[t,n]=(0,s.useState)(""),[l,o]=(0,s.useState)(""),[i,u]=(0,s.useState)(""),[m,h]=(0,s.useState)([]),g=(0,s.useCallback)(c()((async e=>{const a=await async function(e){console.log("fetchTitleSuggestions:",e);try{return(await r.A.get("/api/suggestion/books",{params:{q:e}})).data}catch(a){return console.error("Error fetching title suggestions:",a),[]}}(e);h(a)}),400),[]);return(0,d.jsx)("section",{id:"search_bar",className:"my-3 py-4",style:{background:"rgb(52, 185, 174)"},children:(0,d.jsx)("div",{className:"container",children:(0,d.jsx)("form",{onSubmit:e=>{e.preventDefault();a(e,t,"category"===t?l:i)},children:(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("div",{className:"col-md-5 p-1",children:(0,d.jsxs)("select",{name:"filter",id:"filter",className:"form-control",value:t,onChange:e=>{n(e.target.value),o(""),u(""),h([])},children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"Select Filter..."}),(0,d.jsx)("option",{value:"title",children:"Title"}),(0,d.jsx)("option",{value:"author",children:"Author"}),(0,d.jsx)("option",{value:"category",children:"Category"}),(0,d.jsx)("option",{value:"ISBN",children:"ISBN"})]})}),"category"===t&&(0,d.jsx)("div",{className:"col-md-5 p-1",children:(0,d.jsxs)("select",{name:"category",id:"category",className:"form-control",value:l,onChange:e=>o(e.target.value),children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"Select Category..."}),["Science","Biology","Physics","Chemistry","Novel","Travel","Cooking","Philosophy","Mathematics","Ethics","Technology"].map((e=>(0,d.jsx)("option",{value:e,children:e},e)))]})}),"category"!==t&&(0,d.jsxs)("div",{className:"col-md-5 p-1",children:[(0,d.jsx)("input",{name:"searchName",id:"searchName",type:"text",className:"form-control",placeholder:"Search Books",value:i,onChange:e=>{const a=e.target.value;u(a),"title"===t&&a.length>=3?g(a):h([])}}),"title"===t&&m.length>0&&(0,d.jsx)("ul",{className:"list-group suggestions-list",style:{position:"absolute",zIndex:1e3,width:"100%"},children:m.map(((e,a)=>(0,d.jsx)("li",{className:"list-group-item list-group-item-action",onClick:()=>(e=>{u(e),h([])})(e),children:e},a)))})]}),(0,d.jsx)("div",{className:"col-md-2 p-1",children:(0,d.jsx)("input",{type:"submit",id:"search-book-btn",className:"btn btn-warning btn-block",value:"Search"})})]})})})})};let m;const h=e=>{let{currentUser:a,logout:t}=e;return(0,d.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark p-0 sticky-top",children:(0,d.jsxs)("div",{className:"container",children:[(0,d.jsx)(n.N_,{className:"navbar-brand",to:a?a.isAdmin?"/admin":"/user/dashboard/1":"/",children:"Home"}),(0,d.jsx)("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation",children:(0,d.jsx)("span",{className:"navbar-toggler-icon"})}),(0,d.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[(0,d.jsx)("ul",{className:"navbar-nav",children:(0,d.jsx)("li",{className:"nav-item active px-2",children:(0,d.jsx)(n.N_,{className:"nav-link",to:"/books",children:"Browse Books"})})}),a?(0,d.jsxs)("ul",{className:"navbar-nav ml-auto",children:[a.violationFlag&&(0,d.jsx)("li",{className:"nav-item align-self-center mr-2",children:(0,d.jsx)("i",{className:"fa fa-flag text-danger"})}),(0,d.jsxs)("li",{className:"nav-item dropdown mr-3",children:[(0,d.jsxs)("a",{href:"#",className:"nav-link dropdown-toggle","data-toggle":"dropdown",children:[(0,d.jsx)("i",{className:"fa fa-user"})," Welcome ",a.username]}),(0,d.jsxs)("div",{className:"dropdown-menu",children:[(0,d.jsxs)(n.N_,{to:a.isAdmin?"/admin/profile":"/user/1/profile",className:"dropdown-item",children:[(0,d.jsx)("i",{className:"fa fa-user-circle"})," Profile"]}),(0,d.jsxs)(n.N_,{to:"",onClick:t,className:"dropdown-item",children:[(0,d.jsx)("i",{className:"fa fa-user-times"})," Logout"]})]})]}),(0,d.jsx)("li",{className:"nav-item",children:(0,d.jsxs)(n.N_,{to:"/user/1/notification",className:"nav-link",children:[(0,d.jsx)("i",{className:"fa fa-bell"}),(0,d.jsx)("span",{className:"badge badge-danger badge-pill",children:"2"})]})})]}):(0,d.jsx)(n.N_,{to:"/signUp",className:"btn btn-primary btn-sm ml-auto",children:"Sign up"})]})]})})},g=e=>{var a,t;let{book:s,currentUser:r,handleRequest:l,current:o}=e;return(0,d.jsx)("div",{className:"card col-md-3 text-center",style:{marginBottom:"10px"},children:(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsx)("h5",{className:"card-title",children:s.title}),(0,d.jsx)("p",{children:(0,d.jsxs)("small",{style:{color:"red"},children:["Author: ",s.author]})}),(0,d.jsx)("p",{children:(0,d.jsxs)("small",{style:{color:"rgb(20, 168, 40)"},children:["Category: ",s.category]})}),(0,d.jsx)("p",{children:(0,d.jsxs)("small",{style:{color:"rgb(52, 33, 219)"},children:["In stock: ",s.stock]})}),r&&s.stock>=0&&(0,d.jsx)(d.Fragment,{children:null!==(a=r.bookIssueInfo)&&void 0!==a&&a.some((e=>e._id===s._id))?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{href:"#",className:"btn btn-xs btn-warning disabled",role:"button","aria-disabled":"true",children:"Issued!"}),(0,d.jsx)(n.N_,{to:"/books/return-renew",className:"btn btn-xs btn-success",role:"button",children:"Return/Renew"})]}):null!==(t=r.bookRequestInfo)&&void 0!==t&&t.some((e=>e._id===s._id))?(0,d.jsx)("a",{href:"#",className:"btn btn-xs btn-warning disabled",role:"button","aria-disabled":"true",children:"Requested!"}):(0,d.jsx)("form",{action:"/api/books/".concat(s._id,"/request/").concat(r._id,"/").concat(o),method:"POST",className:"d-inline",onSubmit:l,children:(0,d.jsx)("input",{className:"btn btn-sm btn-warning",type:"submit",value:"request"})})}),(0,d.jsx)(n.N_,{to:"/books/details/".concat(s._id),className:"btn btn-sm btn-success",children:"Details"})]})})},b=e=>{let{books:a,currentUser:t,handleRequest:r,current:n}=e;return(0,d.jsx)(s.Suspense,{fallback:(0,d.jsx)(o.A,{}),children:(0,d.jsx)("section",{id:"browse_books",className:"mt-5",children:(0,d.jsx)("div",{className:"container",children:(0,d.jsx)("div",{className:"row",children:a.map(((e,a)=>(0,d.jsx)(g,{book:e,currentUser:t,handleRequest:r,current:n},a)))})})})})},p=e=>{let{pages:a,current:t,filter:s,value:r,handlePagination:n}=e;return(0,d.jsx)("nav",{className:"ml-3 mb-2",style:{marginTop:"20px"},children:(0,d.jsxs)("ul",{className:"pagination offset-md-3",children:[(0,d.jsx)("li",{className:"page-item ".concat(1===t?"disabled":""),children:(0,d.jsx)("a",{className:"page-link",href:"#",onClick:e=>{e.preventDefault(),n("/api/books/".concat(s,"/").concat(r,"/1"))},children:"First"})}),Array.from({length:Math.min(a,5)},((e,s)=>Math.max(1,Math.min(t-2,a-4))+s)).map((e=>(0,d.jsx)("li",{className:"page-item ".concat(e===t?"active":""),children:(0,d.jsx)("a",{className:"page-link",href:"#",onClick:a=>{a.preventDefault(),n("/api/books/".concat(s,"/").concat(r,"/").concat(e))},children:e})},e))),(0,d.jsx)("li",{className:"page-item ".concat(t<a?"":"disabled"),children:(0,d.jsx)("a",{className:"page-link",href:"#",onClick:e=>{e.preventDefault(),n("/api/books/".concat(s,"/").concat(r,"/").concat(a))},children:"Last"})})]})})},f=()=>{const[e,a]=(0,s.useState)([]),[t,n]=(0,s.useState)(0),[o,i]=(0,s.useState)(1),[c,g]=(0,s.useState)("all"),[f,x]=(0,s.useState)("all"),[j,v]=(0,s.useState)(null),[N,y]=(0,s.useState)(""),[k,w]=(0,s.useState)("");let S=1;(0,s.useEffect)((()=>{m=async()=>{try{const e=await r.A.get("/api/books/all/all/1"),{books:t,current:s,pages:l,filter:o,value:c,user:d}=e.data;a(t),i(s),n(l),g(o),x(c),v(d)}catch(N){y("Failed to fetch books. Please try again later.")}},m()}),[]);const C=(0,s.useCallback)((async e=>{try{const t=await r.A.get(e),{books:s,current:l,pages:o,filter:c,value:d}=t.data;a(s),i(l),n(o),g(c),x(d)}catch(N){console.error("Error handling pagination:",N),y("Failed to load page. Please try again.")}}),[]),_=(0,s.useCallback)((async(e,t,s)=>{e.preventDefault();try{const e=await r.A.get("/api/books/".concat(t,"/").concat(s,"/1"),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(console.log(e.data),e.data.error)return y(e.data.error);const{books:l,current:o,pages:c,filter:d,value:u}=e.data;a(l),i(o),n(c),g(d),x(u)}catch(N){console.error("Error submitting search:",N),y("Search failed. Please try again.")}}),[]),A=(0,s.useCallback)((async e=>{e.preventDefault();const t=new FormData(e.target),s=new URLSearchParams(t).toString();try{const t=await r.A.post(e.target.action,s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(t.data.error)return y(t.data.error);t.data.success&&w(t.data.success),t.data.current&&(S=t.data.current);const l=async()=>{try{const e=await r.A.get("/api/books/all/all/".concat(S)),{books:t,current:s,pages:l,filter:o,value:c,user:d}=e.data;a(t),i(s),n(l),g(o),x(c),v(d)}catch(N){y("Failed to fetch books. Please try again later.")}};l()}catch(N){console.error("Error requesting book:",N),y("Request failed. Please try again.")}}),[]),T=(0,s.useCallback)((async e=>{e.preventDefault();try{await r.A.get("/auth/user-logout"),window.location.reload()}catch(N){console.error("Error logging out:",N),y("Logout failed. Please try again.")}}),[]);return(0,d.jsxs)("div",{children:[(0,d.jsx)(h,{currentUser:j,logout:T}),(0,d.jsx)(u,{handleSubmit:_}),(0,d.jsx)(l.A,{error:N,success:k,dismissAlert:e=>{"error"===e?y(""):"success"===e&&w("")}}),(0,d.jsx)(b,{books:e,currentUser:j,handleRequest:A,current:o}),t>0&&(0,d.jsx)(p,{pages:t,current:o,filter:c,value:f,handlePagination:C})]})}},466:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});t(43);var s=t(579);const r=e=>{let{error:a,success:t,warning:r,dismissAlert:n}=e;return(0,s.jsxs)("div",{className:"container my-2 sticky-top",children:[a&&a.length>0&&(0,s.jsxs)("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[a,(0,s.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:()=>n("error"),children:(0,s.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),t&&t.length>0&&(0,s.jsxs)("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[t,(0,s.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:()=>n("success"),children:(0,s.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),r&&r.length>0&&(0,s.jsxs)("div",{className:"alert alert-warning alert-dismissible fade show",role:"alert",children:[r,(0,s.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:()=>n("warning"),children:(0,s.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]})]})}},446:(e,a,t)=>{var s=NaN,r="[object Symbol]",n=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,c=parseInt,d="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g,u="object"==typeof self&&self&&self.Object===Object&&self,m=d||u||Function("return this")(),h=Object.prototype.toString,g=Math.max,b=Math.min,p=function(){return m.Date.now()};function f(e){var a=typeof e;return!!e&&("object"==a||"function"==a)}function x(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&h.call(e)==r}(e))return s;if(f(e)){var a="function"==typeof e.valueOf?e.valueOf():e;e=f(a)?a+"":a}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var t=o.test(e);return t||i.test(e)?c(e.slice(2),t?2:8):l.test(e)?s:+e}e.exports=function(e,a,t){var s,r,n,l,o,i,c=0,d=!1,u=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(a){var t=s,n=r;return s=r=void 0,c=a,l=e.apply(n,t)}function j(e){var t=e-i;return void 0===i||t>=a||t<0||u&&e-c>=n}function v(){var e=p();if(j(e))return N(e);o=setTimeout(v,function(e){var t=a-(e-i);return u?b(t,n-(e-c)):t}(e))}function N(e){return o=void 0,m&&s?h(e):(s=r=void 0,l)}function y(){var e=p(),t=j(e);if(s=arguments,r=this,i=e,t){if(void 0===o)return function(e){return c=e,o=setTimeout(v,a),d?h(e):l}(i);if(u)return o=setTimeout(v,a),h(i)}return void 0===o&&(o=setTimeout(v,a)),l}return a=x(a)||0,f(t)&&(d=!!t.leading,n=(u="maxWait"in t)?g(x(t.maxWait)||0,a):n,m="trailing"in t?!!t.trailing:m),y.cancel=function(){void 0!==o&&clearTimeout(o),c=0,s=i=r=o=void 0},y.flush=function(){return void 0===o?l:N(p())},y}}}]);
//# sourceMappingURL=105.812d9d91.chunk.js.map